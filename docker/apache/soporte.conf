# Configuración de Apache para Inventario Soporte
<VirtualHost *:80>
    ServerName localhost
    DocumentRoot /usr/local/apache2/htdocs
    
    # Configuración del proxy reverso
    ProxyPreserveHost On
    ProxyRequests Off
    
    # Headers para el proxy
    ProxyPassReverse /soporte/ http://inventario-app:3000/soporte/
    ProxyPassReverse /soporte/api/ http://inventario-app:3000/api/
    
    # Redirección para URLs sin barra final
    RedirectMatch permanent ^/soporte$ /soporte/
    
    # Proxy para la API (más específico primero)
    ProxyPass /soporte/api/ http://inventario-app:3000/api/
    ProxyPassReverse /soporte/api/ http://inventario-app:3000/api/
    
    # Proxy para la aplicación principal
    ProxyPass /soporte/ http://inventario-app:3000/soporte/
    ProxyPassReverse /soporte/ http://inventario-app:3000/soporte/
    
    # Headers necesarios para el proxy
    ProxyPassReverse /soporte/ http://inventario-app:3000/soporte/
    RequestHeader set X-Forwarded-Proto "http"
    RequestHeader set X-Forwarded-Port "80"
    RequestHeader set X-Forwarded-Prefix "/soporte"
    
    # Alias para archivos estáticos
    Alias /soporte/public /usr/local/apache2/htdocs/inventario_soporte/public
    
    # Configuración para archivos estáticos
    <Directory "/usr/local/apache2/htdocs/inventario_soporte/public">
        Options -Indexes +FollowSymLinks
        AllowOverride None
        Require all granted
        
        # Cache para archivos estáticos
        <IfModule mod_expires.c>
            ExpiresActive On
            ExpiresByType text/css "access plus 1 month"
            ExpiresByType application/javascript "access plus 1 month"
            ExpiresByType image/png "access plus 1 month"
            ExpiresByType image/jpg "access plus 1 month"
            ExpiresByType image/jpeg "access plus 1 month"
            ExpiresByType image/gif "access plus 1 month"
            ExpiresByType image/svg+xml "access plus 1 month"
        </IfModule>
    </Directory>
    
    # Configuración de MIME types
    <IfModule mod_mime.c>
        AddType text/css .css
        AddType application/javascript .js
        AddType image/svg+xml .svg
        AddType image/png .png
        AddType image/jpeg .jpg .jpeg
        AddType image/gif .gif
        AddType image/x-icon .ico
        AddType application/font-woff .woff
        AddType application/font-woff2 .woff2
        AddType application/x-font-ttf .ttf
        AddType application/vnd.ms-fontobject .eot
    </IfModule>
    
    # Headers para MIME types
    <IfModule mod_headers.c>
        <FilesMatch "\.(css)$">
            Header set Content-Type "text/css"
        </FilesMatch>
        <FilesMatch "\.(js)$">
            Header set Content-Type "application/javascript"
        </FilesMatch>
        <FilesMatch "\.(svg)$">
            Header set Content-Type "image/svg+xml"
        </FilesMatch>
    </IfModule>
    
    # Logs
    ErrorLog /proc/self/fd/2
    CustomLog /proc/self/fd/1 combined
</VirtualHost>